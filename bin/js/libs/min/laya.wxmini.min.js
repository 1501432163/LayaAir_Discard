!function(n,e,i){i.un,i.uns;var t=i.static,o=i.class,a=i.getset,r=(i.__newvec,laya.utils.Browser),u=(laya.events.Event,laya.events.EventDispatcher),l=laya.resource.HTMLImage,s=laya.utils.Handler,c=laya.display.Input,d=laya.net.Loader,f=laya.utils.RunDriver,h=laya.media.SoundChannel,p=laya.media.SoundManager,v=laya.display.Stage,m=laya.net.URL,w=laya.utils.Utils,_=function(){function e(){}return o(e,"laya.wx.mini.MiniAdpter"),e.getJson=function(n){return JSON.parse(n)},e.init=function(){e._inited||(e._inited=!0,e.window=n,e.EnvConfig={},C.setNativeFileDir("/layaairGame"),C.existDir(C.fileNativeDir,null),v._wgColor=[0,0,0,1],e.window.focus=function(){},i.getUrlPath=function(){},e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e.window.wx.createCanvas().getContext("2d").__proto__,e.window.document.body.appendChild=function(){},e.EnvConfig.pixelRatioInt=0,f.getPixelRatio=e.pixelRatio,e._preCreateElement=r.createElement,r.createElement=e.createElement,f.createShaderCondition=e.createShaderCondition,e.wxRequest=wx.request,wx.request=e.onWxRequest,w.parseXMLFromString=e.parseXMLFromString,d.prototype._loadImage=y.prototype._loadImage)},e.onWxRequest=function(n){var i=n.url,t=w.getFileExtension(i),o=n.responseType;C.isLoadFile(t)?(new g).onFileLoad(i,o,n):e.wxRequest(n)},e.pixelRatio=function(){if(!e.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return e.EnvConfig.pixelRatioInt=n.pixelRatio,n.pixelRatio}catch(n){}return e.EnvConfig.pixelRatioInt},e.createElement=function(i){if("canvas"==i){var t;return t=1==e.idx?n.canvas:n.wx.createCanvas(),e.idx++,t}if("textarea"==i||"input"==i)return e.onCreateInput(i);if("div"==i){var o=e._preCreateElement(i);return o.contains=function(n){return null},o.removeChild=function(n){},o}return e._preCreateElement(i)},e.onCreateInput=function(n){var i=e._preCreateElement(n);return i.focus=x.wxinputFocus,i.blur=x.wxinputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(n){},i.setType=function(n){},i.setFontFace=function(n){},i.addEventListener=function(n){},i.contains=function(n){return null},i.removeChild=function(n){},i},e.createShaderCondition=function(n){var e=this;return function(){return e[n.replace("this.","")]}},e.EnvConfig=null,e.window=null,e._preCreateElement=null,e._inited=!1,e.wxRequest=null,e.parseXMLFromString=function(e){var i;e=e.replace(/>\s+</g,"><");try{i=(new n.Parser.DOMParser).parseFromString(e,"text/xml")}catch(n){throw"需要引入xml解析库文件"}return i},e.idx=1,e}(),y=function(){function n(){}return o(n,"laya.wx.mini.MiniImage"),n.prototype._loadImage=function(e){var i=this;e=m.formatURL(e),C.getFileIsExist(e)?n.onCreateImage(e,i):C.downImg(e,new s(n,n.onDownImgCallBack,[e,i]),e)},n.onDownImgCallBack=function(e,i,t){t?i.onError(null):n.onCreateImage(e,i)},n.onCreateImage=function(n,e){function i(){a.onload=null,a.onerror=null,delete e.imgCache[n]}var t=C.getFileName(n),o=(n.split("?")[0],C.fileNativeDir+"/"+t);null==e.imgCache&&(e.imgCache={});var a,u=function(){i(),e.onLoaded(a)},s=function(){i(),e.event("error","Load image failed")};"nativeimage"==e._type?((a=new r.window.Image).crossOrigin="",a.onload=u,a.onerror=s,a.src=o,e.imgCache[n]=a):new l.create(o,{onload:u,onerror:s,onCreate:function(i){a=i,e.imgCache[n]=i}})},n}(),x=function(){function n(){}return o(n,"laya.wx.mini.MiniInput"),n.wxinputFocus=function(n){var e=c.inputElement.target;e&&!e.editable||(_.window.wx.offKeyboardConfirm(),_.window.wx.offKeyboardInput(),_.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),_.window.wx.onKeyboardConfirm(function(n){var i=n?n.value:"";e.text=i,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),_.window.wx.onKeyboardInput(function(n){var i=n?n.value:"";e.multiline||-1==i.indexOf("\n")?(e.text=i,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},n.inputEnter=function(){c.inputElement.target.focus=!1},n.wxinputblur=function(){n.hideKeyboard()},n.hideKeyboard=function(){_.window.wx.offKeyboardConfirm(),_.window.wx.offKeyboardInput(),_.window.wx.hideKeyboard({success:function(n){console.log("隐藏键盘")},fail:function(n){console.log("隐藏键盘出错:"+(n?n.errMsg:""))}})},n}(),g=function(){function n(){}o(n,"laya.wx.mini.MiniXMLHttpRequest");var e=n.prototype;return e.onFileLoad=function(n,e,i){var t="ascii";-1!=n.indexOf(".fnt")||-1!=n.indexOf("fighter.json")?t="utf8":"arraybuffer"==e&&(t=""),this.onReadNativeFile(n,t,i)},e.onReadNativeFile=function(n,e,i){void 0===e&&(e="ascill"),C.getFileIsExist(n)?C.down(n,e,new s(this,this.onReadFileCallBack,[n,i]),n):C.read(n,e,new s(this,this.onReadFileCallBack,[n,i]),n)},e.onReadFileCallBack=function(n,e,i,t){var o,a={};a.statusCode=200,a.header=e.header,i?2==i||(a.errMsg="request:error",e.fail(a)):(o=t.data,a.data=o,a.errMsg="request:ok",e.success(a))},n}(),C=function(e){function a(){a.__super.call(this)}return o(a,"laya.wx.mini.MiniFileMgr",u),a.isLoadFile=function(n){return-1!=a._fileTypeArr.indexOf(n)},a.getFileIsExist=function(n){var e=n.split("?")[0];return null!=a._filesKey[e]},a.onFileUpdate=function(n,e){var i=e.split("?")[0],t=a._filesKey[i];null==t?a._filesKey[i]=e:t!=e&&a.remove(e)},a.getFileName=function(e){try{return n.utilMd5.hexMD5(e)}catch(n){throw"需要引入md5库文件"}return n.utilMd5.hexMD5(e)},a.exits=function(n,e){var i=a.getFileNativePath(n);a.fs.getFileInfo({filePath:i,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},a.read=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var o=a.getFileNativePath(n);a.fs.readFile({filePath:o,encoding:e,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){n&&a.down(t,e,i,t)}})},a.down=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t="");var o=a.getFileNativePath(t);a.wxdown({url:n,filePath:o,success:function(n){200===n.statusCode&&a.readFile(n.filePath,e,i,t)},fail:function(n){null!=i&&i.runWith([1,n])}}).onProgressUpdate(function(n){null!=i&&i.runWith([2,n.progress])})},a.readFile=function(n,e,i,t){void 0===e&&(e="ascill"),void 0===t&&(t=""),a.fs.readFile({filePath:n,encoding:e,success:function(e){a.onFileUpdate(n,t),null!=i&&i.runWith([0,e])},fail:function(n){n&&null!=i&&i.runWith([1,n])}})},a.downImg=function(n,e,i){void 0===i&&(i="");var t=i.split("?")[0],o=a._filesKey[t],r=a.getFileNativePath(i);a.wxdown({url:n,filePath:r,success:function(n){200===n.statusCode&&(null==o?a._filesKey[t]=i:o!=i&&a.remove(i),null!=e&&e.runWith([0]))},fail:function(n){null!=e&&e.runWith([1,n])}})},a.getFileNativePath=function(n){var e=a.getFileName(n);return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+e},a.remove=function(n){var e=n.split("?")[0],t=a._filesKey[e],o=a.getFileNativePath(t);i.loader.clearRes(t),a.fs.unlink({filePath:o,success:function(i){a._filesKey[e]=n},fail:function(n){}})},a.dir=function(n){a.fs.getSavedFileList({success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){null!=n&&n.runWith([1,e])}})},a.existDir=function(n,e){a.fs.mkdir({dirPath:n,success:function(n){null!=e&&e.runWith([0,n])},fail:function(n){null!=e&&e.runWith([1,n])}})},a.setNativeFileDir=function(n){a.fileNativeDir=wx.env.USER_DATA_PATH+n},a._filesKey={},a.fileNativeDir=null,t(a,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),a}(),F=(function(n){function e(){this._sound=null,this.url=null,this.loaded=!1,e.__super.call(this),this._sound=e._createSound()}o(e,"laya.wx.mini.MiniSound",u);var i=e.prototype;i.load=function(n){function i(){t._sound.onCanplay(null),t._sound.onError(null)}var t=this;if(n=m.formatURL(n),this.url=n,e._audioCache[n])this.event("complete");else{this._sound.src=n,this._sound.onCanplay(function(){i(),o.loaded=!0,o.event("complete"),e._audioCache[o.url]=o});var o=this;this._sound.onError(function(){i(),o.event("error")})}},i.play=function(n,i){void 0===n&&(n=0),void 0===i&&(i=0);var t;this.url==p._musicClass?(e._musicAudio||(e._musicAudio=e._createSound()),t=e._musicAudio):t=e._createSound(),t.src=this.url;var o=new F(t);return o.url=this.url,o.loops=i,o.startTime=n,o.play(),p.addChannel(o),o},i.dispose=function(){var n=e._audioCache[this.url];n&&(n.src="",delete e._audioCache[this.url])},a(0,i,"duration",function(){return this._sound.duration}),e._createSound=function(){return e._id++,_.window.wx.createInnerAudioContext()},e._musicAudio=null,e._id=0,e._audioCache={}}(),function(n){function e(n){this._audio=null,this._onEnd=null,e.__super.call(this),this._audio=n,this._onEnd=w.bind(this.__onEnd,this),n.onEnded(this._onEnd)}o(e,"laya.wx.mini.MiniSoundChannel",h);var t=e.prototype;return t.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(i.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},t.play=function(){this.isStopped=!1,p.addChannel(this),this._audio.play()},t.stop=function(){this.isStopped=!0,p.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.onEnded(null),this._audio=null)},t.pause=function(){this.isStopped=!0,this._audio.pause()},t.resume=function(){this._audio&&(this.isStopped=!1,p.addChannel(this),this._audio.play())},a(0,t,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,t,"duration",function(){return this._audio?this._audio.duration:0}),a(0,t,"volume",function(){return 1},function(n){}),e}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});for(var i in Laya){var t=Laya[i];t&&t.__isclass&&(e[i]=t)}});